repo,test_patch,problem_statement,FAIL_TO_PASS,PASS_TO_PASS,language
laravel/framework,"diff --git a/tests/Database/DatabaseEloquentModelTest.php b/tests/Database/DatabaseEloquentModelTest.php
index 848066bff7da..239e91eed71a 100755
--- a/tests/Database/DatabaseEloquentModelTest.php
+++ b/tests/Database/DatabaseEloquentModelTest.php
@@ -23,6 +23,8 @@
 use Illuminate\Database\Eloquent\Casts\AsEnumCollection;
 use Illuminate\Database\Eloquent\Casts\AsStringable;
 use Illuminate\Database\Eloquent\Collection;
+use Illuminate\Database\Eloquent\Concerns\HasUlids;
+use Illuminate\Database\Eloquent\Concerns\HasUuids;
 use Illuminate\Database\Eloquent\JsonEncodingException;
 use Illuminate\Database\Eloquent\MassAssignmentException;
 use Illuminate\Database\Eloquent\MissingAttributeException;
@@ -1766,6 +1768,98 @@ public function testCloneModelMakesAFreshCopyOfTheModel()
         $this->assertEquals(['bar'], $clone->foo);
     }
 
+    public function testCloneModelMakesAFreshCopyOfTheModelWhenModelHasUuidPrimaryKey()
+    {
+        $class = new EloquentPrimaryUuidModelStub();
+        $class->uuid = 'ccf55569-bc4a-4450-875f-b5cffb1b34ec';
+        $class->exists = true;
+        $class->first = 'taylor';
+        $class->last = 'otwell';
+        $class->created_at = $class->freshTimestamp();
+        $class->updated_at = $class->freshTimestamp();
+        $class->setRelation('foo', ['bar']);
+
+        $clone = $class->replicate();
+
+        $this->assertNull($clone->uuid);
+        $this->assertFalse($clone->exists);
+        $this->assertSame('taylor', $clone->first);
+        $this->assertSame('otwell', $clone->last);
+        $this->assertArrayNotHasKey('created_at', $clone->getAttributes());
+        $this->assertArrayNotHasKey('updated_at', $clone->getAttributes());
+        $this->assertEquals(['bar'], $clone->foo);
+    }
+
+    public function testCloneModelMakesAFreshCopyOfTheModelWhenModelHasUuid()
+    {
+        $class = new EloquentNonPrimaryUuidModelStub();
+        $class->id = 1;
+        $class->uuid = 'ccf55569-bc4a-4450-875f-b5cffb1b34ec';
+        $class->exists = true;
+        $class->first = 'taylor';
+        $class->last = 'otwell';
+        $class->created_at = $class->freshTimestamp();
+        $class->updated_at = $class->freshTimestamp();
+        $class->setRelation('foo', ['bar']);
+
+        $clone = $class->replicate();
+
+        $this->assertNull($clone->id);
+        $this->assertNull($clone->uuid);
+        $this->assertFalse($clone->exists);
+        $this->assertSame('taylor', $clone->first);
+        $this->assertSame('otwell', $clone->last);
+        $this->assertArrayNotHasKey('created_at', $clone->getAttributes());
+        $this->assertArrayNotHasKey('updated_at', $clone->getAttributes());
+        $this->assertEquals(['bar'], $clone->foo);
+    }
+
+    public function testCloneModelMakesAFreshCopyOfTheModelWhenModelHasUlidPrimaryKey()
+    {
+        $class = new EloquentPrimaryUlidModelStub();
+        $class->ulid = '01HBZ975D8606P6CV672KW1AP2';
+        $class->exists = true;
+        $class->first = 'taylor';
+        $class->last = 'otwell';
+        $class->created_at = $class->freshTimestamp();
+        $class->updated_at = $class->freshTimestamp();
+        $class->setRelation('foo', ['bar']);
+
+        $clone = $class->replicate();
+
+        $this->assertNull($clone->ulid);
+        $this->assertFalse($clone->exists);
+        $this->assertSame('taylor', $clone->first);
+        $this->assertSame('otwell', $clone->last);
+        $this->assertArrayNotHasKey('created_at', $clone->getAttributes());
+        $this->assertArrayNotHasKey('updated_at', $clone->getAttributes());
+        $this->assertEquals(['bar'], $clone->foo);
+    }
+
+    public function testCloneModelMakesAFreshCopyOfTheModelWhenModelHasUlid()
+    {
+        $class = new EloquentNonPrimaryUlidModelStub();
+        $class->id = 1;
+        $class->ulid = '01HBZ975D8606P6CV672KW1AP2';
+        $class->exists = true;
+        $class->first = 'taylor';
+        $class->last = 'otwell';
+        $class->created_at = $class->freshTimestamp();
+        $class->updated_at = $class->freshTimestamp();
+        $class->setRelation('foo', ['bar']);
+
+        $clone = $class->replicate();
+
+        $this->assertNull($clone->id);
+        $this->assertNull($clone->ulid);
+        $this->assertFalse($clone->exists);
+        $this->assertSame('taylor', $clone->first);
+        $this->assertSame('otwell', $clone->last);
+        $this->assertArrayNotHasKey('created_at', $clone->getAttributes());
+        $this->assertArrayNotHasKey('updated_at', $clone->getAttributes());
+        $this->assertEquals(['bar'], $clone->foo);
+    }
+
     public function testModelObserversCanBeAttachedToModels()
     {
         EloquentModelStub::setEventDispatcher($events = m::mock(Dispatcher::class));
@@ -3158,6 +3252,62 @@ class EloquentDifferentConnectionModelStub extends EloquentModelStub
     public $connection = 'different_connection';
 }
 
+class EloquentPrimaryUuidModelStub extends EloquentModelStub
+{
+    use HasUuids;
+
+    public $incrementing = false;
+    protected $keyType = 'string';
+
+    public function getKeyName()
+    {
+        return 'uuid';
+    }
+}
+
+class EloquentNonPrimaryUuidModelStub extends EloquentModelStub
+{
+    use HasUuids;
+
+    public function getKeyName()
+    {
+        return 'id';
+    }
+
+    public function uniqueIds()
+    {
+        return ['uuid'];
+    }
+}
+
+class EloquentPrimaryUlidModelStub extends EloquentModelStub
+{
+    use HasUlids;
+
+    public $incrementing = false;
+    protected $keyType = 'string';
+
+    public function getKeyName()
+    {
+        return 'ulid';
+    }
+}
+
+class EloquentNonPrimaryUlidModelStub extends EloquentModelStub
+{
+    use HasUlids;
+
+    public function getKeyName()
+    {
+        return 'id';
+    }
+
+    public function uniqueIds()
+    {
+        return ['ulid'];
+    }
+}
+
 class EloquentModelSavingEventStub
 {
     //
","[10.x] `Model::replicate()` doesn't take into account unique IDs
### Laravel Version

10.21.0

### PHP Version

8.1.21

### Database Driver & Version

N/A

### Description

When replicating a model, some columns are purposefully omitted from the replica so that the original record will not be overwritten in the database.
By default replication excludes the model's primary key but not any additional unique keys. This means that these keys will need to be excluded manually or manually set before saving. This is only a problem when using `HasUuids` or `HasUlids` on columns that are not the model's primary key.

### Steps To Reproduce

1. Create a model and a migration with at least two columns, e.g.:

```php
Schema::table('users', function (Blueprint $table) {
    $table->id();
    $table->uuid();
});
```

2. Add the `HasUuids` trait to the model and indicate which columns are unique IDs:

```php
    public function uniqueIds()
    {
        return ['uuid'];
    }
```

3. Populate the database and attempt to replicate a model

```php
$user = User::first();
$otherUser = tap($user->replicate())->save();
```

PS. I can create a PR to fix this, but I am unsure if this should be fixed in Laravel 10 or 11, its technically a bugfix and I can't imagine anyone relying on this current behavior
","['Database Eloquent Model > Clone model makes a fresh copy of the model when model has uuid', 'Database Eloquent Model > Clone model makes a fresh copy of the model when model has ulid']","['Database Eloquent Model > Attribute manipulation', 'Database Eloquent Model > Set attribute with numeric key', 'Database Eloquent Model > Dirty attributes', 'Database Eloquent Model > Int and null comparison when dirty', 'Database Eloquent Model > Float and null comparison when dirty', 'Database Eloquent Model > Dirty on cast or date attributes', 'Database Eloquent Model > Dirty on casted objects', 'Database Eloquent Model > Dirty on casted array object', 'Database Eloquent Model > Dirty on casted collection', 'Database Eloquent Model > Dirty on casted custom collection', 'Database Eloquent Model > Dirty on casted stringable', 'Database Eloquent Model > Dirty on casted encrypted collection', 'Database Eloquent Model > Dirty on casted encrypted custom collection', 'Database Eloquent Model > Dirty on casted encrypted array object', 'Database Eloquent Model > Dirty on enum collection object', 'Database Eloquent Model > Dirty on enum array object', 'Database Eloquent Model > Has casts on enum attribute', 'Database Eloquent Model > Clean attributes', 'Database Eloquent Model > Clean when float update attribute', 'Database Eloquent Model > Calculated attributes', 'Database Eloquent Model > Array access to attributes', 'Database Eloquent Model > Only', 'Database Eloquent Model > New instance returns new instance with attributes set', 'Database Eloquent Model > New instance returns new instance with table set', 'Database Eloquent Model > New instance returns new instance with merged casts', 'Database Eloquent Model > Create method saves new model', 'Database Eloquent Model > Make method does not save new model', 'Database Eloquent Model > Force create method saves new model with guarded attributes', 'Database Eloquent Model > Find method use write pdo', 'Database Eloquent Model > Destroy method calls query builder correctly', 'Database Eloquent Model > Destroy method calls query builder correctly with collection', 'Database Eloquent Model > Destroy method calls query builder correctly with eloquent collection', 'Database Eloquent Model > Destroy method calls query builder correctly with multiple args', 'Database Eloquent Model > Destroy method calls query builder correctly with empty ids', 'Database Eloquent Model > With method calls query builder correctly', 'Database Eloquent Model > Without method removes eager loaded relationship correctly', 'Database Eloquent Model > With only method loads relationship correctly', 'Database Eloquent Model > Eager loading with columns', 'Database Eloquent Model > With where has with specific columns', 'Database Eloquent Model > With method calls query builder correctly with array', 'Database Eloquent Model > Update process', 'Database Eloquent Model > Update process doesnt override timestamps', 'Database Eloquent Model > Save is canceled if saving event returns false', 'Database Eloquent Model > Update is canceled if updating event returns false', 'Database Eloquent Model > Events can be fired with custom event objects', 'Database Eloquent Model > Update process without timestamps', 'Database Eloquent Model > Update uses old primary key', 'Database Eloquent Model > Timestamps are returned as objects', 'Database Eloquent Model > Timestamps are returned as objects from plain dates and timestamps', 'Database Eloquent Model > Timestamps are returned as objects on create', 'Database Eloquent Model > Date time attributes return null if set to null', 'Database Eloquent Model > Timestamps are created from strings and integers', 'Database Eloquent Model > From date time', 'Database Eloquent Model > From date time milliseconds', 'Database Eloquent Model > Insert process', 'Database Eloquent Model > Insert is canceled if creating event returns false', 'Database Eloquent Model > Delete properly deletes model', 'Database Eloquent Model > Push no relations', 'Database Eloquent Model > Push empty one relation', 'Database Eloquent Model > Push one relation', 'Database Eloquent Model > Push empty many relation', 'Database Eloquent Model > Push many relation', 'Database Eloquent Model > New query returns eloquent query builder', 'Database Eloquent Model > Get and set table operations', 'Database Eloquent Model > Get key returns value of primary key', 'Database Eloquent Model > Connection management', 'Database Eloquent Model > To array', 'Database Eloquent Model > Visible creates array whitelist', 'Database Eloquent Model > Hidden can also exclude relationships', 'Database Eloquent Model > Get arrayable relations function exclude hidden relationships', 'Database Eloquent Model > To array snake attributes', 'Database Eloquent Model > To array uses mutators', 'Database Eloquent Model > Hidden', 'Database Eloquent Model > Visible', 'Database Eloquent Model > Dynamic hidden', 'Database Eloquent Model > With hidden', 'Database Eloquent Model > Make hidden', 'Database Eloquent Model > Dynamic visible', 'Database Eloquent Model > Make visible if', 'Database Eloquent Model > Make hidden if', 'Database Eloquent Model > Fillable', 'Database Eloquent Model > Qualify column', 'Database Eloquent Model > Force fill method fills guarded attributes', 'Database Eloquent Model > Filling j s o n attributes', 'Database Eloquent Model > Unguard allows anything to be set', 'Database Eloquent Model > Underscore properties are not filled', 'Database Eloquent Model > Guarded', 'Database Eloquent Model > Uses overridden handler when discarding attributes', 'Database Eloquent Model > Fillable overrides guarded', 'Database Eloquent Model > Global guarded', 'Database Eloquent Model > Unguarded runs callback while being unguarded', 'Database Eloquent Model > Unguarded call does not change unguarded state', 'Database Eloquent Model > Unguarded call does not change unguarded state on exception', 'Database Eloquent Model > Has one creates proper relation', 'Database Eloquent Model > Morph one creates proper relation', 'Database Eloquent Model > Correct morph class is returned', 'Database Eloquent Model > Has many creates proper relation', 'Database Eloquent Model > Morph many creates proper relation', 'Database Eloquent Model > Belongs to creates proper relation', 'Database Eloquent Model > Morph to creates proper relation', 'Database Eloquent Model > Belongs to many creates proper relation', 'Database Eloquent Model > Relations with varied connections', 'Database Eloquent Model > Models assume their name', 'Database Eloquent Model > The mutator cache is populated', 'Database Eloquent Model > Route key is primary key', 'Database Eloquent Model > Route name is primary key name', 'Database Eloquent Model > Clone model makes a fresh copy of the model', 'Database Eloquent Model > Clone model makes a fresh copy of the model when model has uuid primary key', 'Database Eloquent Model > Clone model makes a fresh copy of the model when model has ulid primary key', 'Database Eloquent Model > Model observers can be attached to models', 'Database Eloquent Model > Model observers can be attached to models with string', 'Database Eloquent Model > Model observers can be attached to models through an array', 'Database Eloquent Model > Throw exception on attaching not exists model observer with string', 'Database Eloquent Model > Throw exception on attaching not exists model observers through an array', 'Database Eloquent Model > Model observers can be attached to models through calling observe method only once', 'Database Eloquent Model > Without event dispatcher', 'Database Eloquent Model > Set observable events', 'Database Eloquent Model > Add observable event', 'Database Eloquent Model > Add multiple observeable events', 'Database Eloquent Model > Remove observable event', 'Database Eloquent Model > Remove multiple observable events', 'Database Eloquent Model > Get model attribute method throws exception if not relation', 'Database Eloquent Model > Model is booted on unserialize', 'Database Eloquent Model > Models trait is initialized', 'Database Eloquent Model > Appending of attributes', 'Database Eloquent Model > Get mutated attributes', 'Database Eloquent Model > Replicate creates a new model instance with same attribute values', 'Database Eloquent Model > Replicating event is fired when replicating model', 'Database Eloquent Model > Replicate quietly creates a new model instance with same attribute values and is quiet', 'Database Eloquent Model > Increment on existing model calls query and sets attribute', 'Database Eloquent Model > Increment quietly on existing model calls query and sets attribute and is quiet', 'Database Eloquent Model > Decrement quietly on existing model calls query and sets attribute and is quiet', 'Database Eloquent Model > Relationship touch owners is propagated', 'Database Eloquent Model > Relationship touch owners is not propagated if no relationship result', 'Database Eloquent Model > Model attributes are casted when present in casts array', 'Database Eloquent Model > Model date attribute casting resets time', 'Database Eloquent Model > Model attribute casting preserves null', 'Database Eloquent Model > Model attribute casting fails on unencodable data', 'Database Eloquent Model > Model attribute casting with special float values', 'Database Eloquent Model > Merge casts merges casts', 'Database Eloquent Model > Updating non existent model fails', 'Database Eloquent Model > Isset behaves correctly with attributes and relationships', 'Database Eloquent Model > Non existing attribute with internal method name doesnt call method', 'Database Eloquent Model > Int key type preserved', 'Database Eloquent Model > String key type preserved', 'Database Eloquent Model > Scopes method', 'Database Eloquent Model > Scopes method with string', 'Database Eloquent Model > Is with null', 'Database Eloquent Model > Is with the same model instance', 'Database Eloquent Model > Is with another model instance', 'Database Eloquent Model > Is with another table', 'Database Eloquent Model > Is with another connection', 'Database Eloquent Model > Without touching callback', 'Database Eloquent Model > Without touching on callback', 'Database Eloquent Model > Throws when accessing missing attributes', 'Database Eloquent Model > Uses overridden handler when accessing missing attributes', 'Database Eloquent Model > Doesnt throw when accessing missing attributes on model that is not saved', 'Database Eloquent Model > Doesnt throw when accessing missing attributes on model that was recently created', 'Database Eloquent Model > Doesnt throw when assigning missing attributes', 'Database Eloquent Model > Doesnt throw when testing missing attributes', 'Database Eloquent Model > Touching model with timestamps', 'Database Eloquent Model > Not touching model with updated at null', 'Database Eloquent Model > Not touching model without timestamps', 'Database Eloquent Model > Get original casts attributes', 'Database Eloquent Model > Unsaved model', 'Database Eloquent Model > Discard changes']",PHP
