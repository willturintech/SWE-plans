repo,test_patch,problem_statement,FAIL_TO_PASS,PASS_TO_PASS,language
redis/redis,"diff --git a/tests/unit/acl.tcl b/tests/unit/acl.tcl
index 3a1dcbf6c35..0900d8e037f 100644
--- a/tests/unit/acl.tcl
+++ b/tests/unit/acl.tcl
@@ -175,7 +175,7 @@ start_server {tags {""acl external:skip""}} {
         set curruser ""hpuser""
         foreach user [lshuffle $users] {
             if {[string first $curruser $user] != -1} {
-                assert_equal {user hpuser on nopass resetchannels &foo +@all} $user
+                assert_equal {user hpuser on nopass sanitize-payload resetchannels &foo +@all} $user
             }
         }
 
@@ -469,6 +469,27 @@ start_server {tags {""acl external:skip""}} {
         r AUTH newuser passwd1
     }
 
+    test {ACL SETUSER RESET reverting to default newly created user} {
+        set current_user ""example""
+        r ACL DELUSER $current_user
+        r ACL SETUSER $current_user
+
+        set users [r ACL LIST]
+        foreach user [lshuffle $users] {
+            if {[string first $current_user $user] != -1} {
+                set current_user_output $user
+            }
+        }
+
+        r ACL SETUSER $current_user reset
+        set users [r ACL LIST]
+        foreach user [lshuffle $users] {
+            if {[string first $current_user $user] != -1} {
+                assert_equal $current_user_output $user
+            }
+        }
+    }
+
     # Note that the order of the generated ACL rules is not stable in Redis
     # so we need to match the different parts and not as a whole string.
     test {ACL GETUSER is able to translate back command permissions} {
","[BUG] `ACL SETUSER ... reset` doesn't revert to true defaults
**Describe the bug**

`ACL SETUSER` with the `reset` argument doesn't return to the _exact_ defaults as those of a newly-created user.
Specifically, the `sanitize-payload` that is implicitly added by `sanitize-dump` configuration directive (default: clients) is added.
I'm not entirely clear about all the implications, but this irks me, so low-level priority for sure :)

**To reproduce**

```
127.0.0.1:6379> ACL SETUSER example
OK
127.0.0.1:6379> ACL LIST
1) ""user default on nopass ~* &* +@all""
2) ""user example off resetchannels -@all""
127.0.0.1:6379> ACL SETUSER example reset
OK
127.0.0.1:6379> ACL LIST
1) ""user default on nopass ~* &* +@all""
2) ""user example off sanitize-payload resetchannels -@all""
```


**Expected behavior**

The `sanitize-payload` shouldn't be there - `reset` means reverting to default.


","['Validate subset of channels is prefixed with resetchannels flag', 'ACL SETUSER RESET reverting to default newly created user']","['Connections start with the default user', 'It is possible to create new users', 'Usernames can not contain spaces or null characters', 'New users start disabled', 'Enabling the user allows the login', 'Only the set of correct passwords work', 'It is possible to remove passwords from the set of valid ones', 'Test password hashes can be added', 'Test password hashes validate input', 'ACL GETUSER returns the password hash instead of the actual password', 'Test hashed passwords removal', 'By default users are not able to access any command', 'By default users are not able to access any key', ""It's possible to allow the access of a subset of keys"", 'By default, only default user is able to publish to any channel', 'By default, only default user is not able to publish to any shard channel', 'By default, only default user is able to subscribe to any channel', 'By default, only default user is able to subscribe to any shard channel', 'By default, only default user is able to subscribe to any pattern', ""It's possible to allow publishing to a subset of channels"", ""It's possible to allow publishing to a subset of shard channels"", 'In transaction queue publish/subscribe/psubscribe to unauthorized channel will fail', ""It's possible to allow subscribing to a subset of channels"", ""It's possible to allow subscribing to a subset of shard channels"", ""It's possible to allow subscribing to a subset of channel patterns"", 'Subscribers are killed when revoked of channel permission', 'Subscribers are killed when revoked of pattern permission', 'Subscribers are pardoned if literal permissions are retained and/or gaining allchannels', 'Users can be configured to authenticate with any password', 'ACLs can exclude single commands', 'ACLs can include or exclude whole classes of commands', 'ACLs can include single subcommands', 'ACLs can exclude single subcommands, case 1', 'ACLs can exclude single subcommands, case 2', 'ACLs cannot include a subcommand with a specific arg', 'ACLs cannot exclude or include a container commands with a specific arg', 'ACLs cannot exclude or include a container command with two args', 'ACLs including of a type includes also subcommands', 'ACLs can block SELECT of all but a specific DB', 'ACLs can block all DEBUG subcommands except one', 'ACLs set can include subcommands, if already full command exists', 'ACLs set can exclude subcommands, if already full command exists', 'ACL GETUSER is able to translate back command permissions', 'ACL GETUSER provides reasonable results', 'ACL CAT with illegal arguments', 'ACL CAT without category - list all categories', 'ACL CAT category - list all commands/subcommands that belong to category', 'ACL requires explicit permission for scripting for EVAL_RO, EVALSHA_RO and FCALL_RO', 'ACL #5998 regression: memory leaks adding / removing subcommands', 'ACL LOG shows failed command executions at toplevel', 'ACL LOG shows failed subcommand executions at toplevel', 'ACL LOG is able to test similar events', 'ACL LOG is able to log keys access violations and key name', 'ACL LOG is able to log channel access violations and channel name', 'ACL LOG RESET is able to flush the entries in the log', 'ACL LOG can distinguish the transaction context (1)', 'ACL LOG can distinguish the transaction context (2)', 'ACL can log errors in the context of Lua scripting', 'ACL LOG can accept a numerical argument to show less entries', 'ACL LOG can log failed auth attempts', 'ACL LOG entries are limited to a maximum amount', 'When default user is off, new connections are not authenticated', 'When default user has no command permission, hello command still works for other users', 'ACL HELP should not have unexpected options', ""Delete a user that the client doesn't use"", 'Delete a user that the client is using', 'ACL GENPASS command failed test', 'Default user can not be removed', 'ACL load non-existing configured ACL file', 'default: load from include file, can access any channels', 'default: with config acl-pubsub-default allchannels after reset, can access any channels', 'default: with config acl-pubsub-default resetchannels after reset, can not access any channels', 'Alice: can execute all command', 'Bob: just execute @set and acl command', 'ACL load and save', 'ACL load and save with restricted channels', 'Default user has access to all channels irrespective of flag', ""Update acl-pubsub-default, existing users shouldn't get affected"", 'Single channel is valid', 'Single channel is not valid with allchannels', 'Only default user has access to all channels irrespective of flag', ""default: load from config file, without channel permission default user can't access any channels"", 'default: load from config file with all channels permissions', 'Test loading an ACL file with duplicate users', 'Test loading an ACL file with duplicate default user', 'Test loading duplicate users in config on startup', 'ACL from config file and config rewrite']",C
